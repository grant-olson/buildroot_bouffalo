From 90a4c644d0306da6a99af5969d05b01a991eaecc Mon Sep 17 00:00:00 2001
From: "Grant T. Olson" <kgo@grant-olson.net>
Date: Wed, 8 Feb 2023 15:37:30 -0500
Subject: [PATCH 4/4] Disable OTG power settings

---
 apps/m0_lowload/src/usb_hc_init.c | 15 ++++++++-------
 1 file changed, 8 insertions(+), 7 deletions(-)

diff --git a/apps/m0_lowload/src/usb_hc_init.c b/apps/m0_lowload/src/usb_hc_init.c
index 88a85e2..627a984 100644
--- a/apps/m0_lowload/src/usb_hc_init.c
+++ b/apps/m0_lowload/src/usb_hc_init.c
@@ -131,28 +131,29 @@ void usb_hc_low_level_init(void)
     //bflb_irq_enable(37);
 
     /* enable device-A for host */
-    regval = getreg32(BFLB_PDS_BASE + PDS_USB_CTL_OFFSET);
     regval &= ~PDS_REG_USB_IDDIG;
     putreg32(regval, BFLB_PDS_BASE + PDS_USB_CTL_OFFSET);
 
     
+    /*    regval = getreg32(BFLB_PDS_BASE + PDS_USB_CTL_OFFSET);
     regval = getreg32(BLFB_USB_BASE + USB_OTG_CSR_OFFSET);
     regval |= USB_A_BUS_DROP_HOV;
     regval &= ~USB_A_BUS_REQ_HOV;
     putreg32(regval, BLFB_USB_BASE + USB_OTG_CSR_OFFSET);
+    */
 
     bflb_mtimer_delay_ms(10);
-
     /* enable vbus and bus control */
-    regval = getreg32(BLFB_USB_BASE + USB_OTG_CSR_OFFSET);
+    /*    regval = getreg32(BLFB_USB_BASE + USB_OTG_CSR_OFFSET);
     regval &= ~USB_A_BUS_DROP_HOV;
     regval |= USB_A_BUS_REQ_HOV;
     putreg32(regval, BLFB_USB_BASE + USB_OTG_CSR_OFFSET);
-
+    */
+    
     regval = getreg32(BLFB_USB_BASE + USB_GLB_INT_OFFSET);
-    regval &= ~USB_MDEV_INT;
-    regval |= USB_MOTG_INT;
-    regval |= USB_MHC_INT;
+    regval |= USB_MDEV_INT;
+    regval &= ~USB_MOTG_INT;
+    regval &= ~USB_MHC_INT;
     putreg32(regval, BLFB_USB_BASE + USB_GLB_INT_OFFSET);
 }
 
-- 
2.34.1

